# c6代码审计

C6源码如下，目前根据已经出来的漏洞情报做代码层面的跟踪复现

![image-20250811133656629](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20250811133656629.png)

金和oa C6  aspx调用会有对应的C#文件终端，定位到`JHSoft.Web.Portal`文件夹下面的`SaveXmlAjax.aspx`文件，内容如下

借用一下图，没这个文件

![图像.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/07/attach-f5eb2997da32d265665a90ea5addc55565ce53bd.png)

从这个图，定位反编译dll

![image-20250811134140695](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20250811134140695.png)

![image-20250811134306484](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20250811134306484.png)

然后cs 文件跟踪定位是SaveMenuXml  这个方法

跟进函数

![image-20250811134452660](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20250811134452660.png)

````c#
namespace JHSoft.Web.Portal
	{
	// Token: 0x0200000E RID: 14
	public class SaveXmlAjax : Page
	{
		// Token: 0x0600001D RID: 29 RVA: 0x000031B0 File Offset: 0x000013B0
		protected void Page_Load(object sender, EventArgs e)
		{
			if (base.Request.QueryString["strItems"] != null)
			{
				this.strItems = base.Request.QueryString["strItems"].ToString();
			}
			if (base.Request.QueryString["Type"] != null)
			{
				this.type = base.Request.QueryString["Type"].ToString();
			}
			this.SaveMenuXml();
		}
  这里传入了两个参数strItems 跟 Type  ，之后调用了对应的SaveMenuXml方法，跟进方法查看
````

![image-20250811134706413](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20250811134706413.png)

````c#
public string SaveMenuXml()
	{
		StringBuilder stringBuilder = new StringBuilder();
		string str = this.strItems.Replace("|", "','");
		string queryString = "select NodeCode,Name,URL,Image,KeyCode from dbo.NavigationBar where NodeCode in ('" + str + "') and SystemGUID is null";
		DataTable dataTable = this.dbo.ExecSQLReDataTable(queryString);
		stringBuilder.Append("<title>");
	}
可以看到strIrems参数中的|被替换成了','之后直接打印到了SQL语句，因此造成了注入漏洞
 "select NodeCode,Name,URL,Image,KeyCode from dbo.NavigationBar where NodeCode in ('" + str + "') and SystemGUID is null" 
````

